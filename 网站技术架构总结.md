# 生命教練網 - 技術架構總結

## 📋 項目概述

**生命教練網** 是一個基於 AI 的命理分析平台，提供八字命理、紫微斗數、占卜系統、姓名學和擇日系統等服務。網站採用現代化的前端技術棧和 Serverless 後端架構。

## 🛠️ 技術棧

### 前端技術

#### 核心框架
- **Vue 3** (v3.5.13) - 使用 Composition API
- **TypeScript** (v5.8.3) - 類型安全
- **Vite** (v5.2.9) - 現代化構建工具

#### 路由與狀態管理
- **Vue Router 4** (v4.5.1) - 客戶端路由
- 使用 Composition API 進行狀態管理（無需 Vuex/Pinia）

#### UI 與樣式
- **原生 CSS** - 自定義樣式系統
- **響應式設計** - 支援桌面、平板、手機
- **漸層背景** - 現代化視覺設計

#### 工具庫
- **solarlunar** (v2.0.7) - 農曆轉換工具

### 後端技術

#### Serverless Functions
- **Vercel Serverless Functions** - 無伺服器架構
- **Node.js** - 運行環境
- **Express** (v4.18.2) - API 路由處理

#### API 服務
- **OpenAI GPT API** - AI 命理分析
- **node-fetch** (v2.6.7) - HTTP 請求
- **CORS** (v2.8.5) - 跨域支援

### 部署與基礎設施

#### 部署平台
- **Vercel** - 前端和 Serverless Functions 部署
- **GitHub** - 版本控制與 CI/CD

#### SEO 與優化
- **Sitemap.xml** - 搜索引擎優化
- **Robots.txt** - 爬蟲控制
- **Google Search Console** - 搜索監控
- **Google AdSense** - 廣告整合

## 🏗️ 架構設計

### 整體架構

```
┌─────────────────────────────────────────────────┐
│                  用戶瀏覽器                      │
└─────────────────┬───────────────────────────────┘
                  │
                  │ HTTPS
                  │
┌─────────────────▼───────────────────────────────┐
│              Vercel CDN                          │
│  ┌──────────────────────────────────────────┐   │
│  │  前端應用 (Vue 3 SPA)                     │   │
│  │  - 靜態資源 (HTML/CSS/JS)                 │   │
│  │  - 路由: Vue Router                       │   │
│  └──────────────────────────────────────────┘   │
│                                                  │
│  ┌──────────────────────────────────────────┐   │
│  │  Serverless Functions                     │   │
│  │  - /api/gpt (GPT API 代理)                │   │
│  │  - /api/health (健康檢查)                  │   │
│  └──────────────────────────────────────────┘   │
└─────────────────┬───────────────────────────────┘
                  │
                  │ API 請求
                  │
┌─────────────────▼───────────────────────────────┐
│          外部服務                                │
│  - OpenAI GPT API                               │
│  - Google AdSense                               │
└─────────────────────────────────────────────────┘
```

### 前端架構

#### 目錄結構
```
src/
├── components/          # 可重用組件
│   ├── AdBanner.vue    # 廣告橫幅組件
│   ├── Navbar.vue      # 導航欄
│   ├── TarotCard.vue   # 塔羅牌組件
│   └── SimpleTarotCard.vue
│
├── composables/        # Composition API 組合函數
│   ├── useAdGating.ts  # 廣告門控邏輯
│   └── useAdRevenue.ts # 廣告收益追蹤
│
├── services/           # API 服務層
│   ├── gptService.ts  # GPT API 統一服務 (1477行)
│   ├── freeAIService.ts # 免費 AI 服務
│   └── quotaMonitor.ts # API 配額監控
│
├── views/             # 頁面組件
│   ├── HomeView.vue   # 首頁
│   ├── FormView.vue   # 八字表單
│   ├── ResultView.vue  # 八字結果
│   ├── ZiWeiView.vue  # 紫微表單
│   ├── ZiWeiResult.vue # 紫微結果
│   ├── Divination.vue  # 占卜選擇頁
│   ├── TarotDivination.vue # 塔羅占卜
│   ├── IChingDivination.vue # 易經占卜
│   ├── NameView.vue   # 姓名學
│   └── CalendarView.vue # 擇日系統
│
├── router/            # 路由配置
│   └── index.ts       # 路由定義
│
├── utils/             # 工具函數
│   ├── dateSelection.ts # 日期選擇
│   ├── tarotCards.ts  # 塔羅牌數據
│   ├── ichingHexagrams.ts # 易經卦象
│   └── nameAnalysis.ts # 姓名分析
│
├── config.ts          # 配置文件
├── App.vue           # 根組件
└── main.ts           # 應用入口
```

#### 組件層級
```
App.vue (根組件)
├── Navbar (導航欄)
├── AdBanner (側邊廣告)
├── router-view (動態頁面)
│   ├── HomeView
│   ├── FormView
│   ├── ResultView
│   ├── ZiWeiView
│   ├── ZiWeiResult
│   └── ...
└── AdBanner (底部廣告)
```

### 後端架構

#### Serverless Functions 結構
```
api/
├── gpt/
│   └── index.js      # GPT API 代理
├── health/
│   └── index.js      # 健康檢查
└── hello/
    └── index.js      # 測試端點
```

#### API 流程
```
前端請求
  ↓
gptService.ts (統一服務層)
  ↓
/api/gpt (Serverless Function)
  ↓
OpenAI GPT API
  ↓
返回結果
```

## 🔄 數據流

### 命理分析流程

```
用戶輸入
  ↓
表單驗證 (FormView/ZiWeiView)
  ↓
數據格式化
  ↓
gptService.ts 調用
  ├── 請求頻率控制
  ├── 錯誤重試機制
  └── 配額監控
  ↓
/api/gpt Serverless Function
  ├── CORS 處理
  ├── API Key 驗證
  └── OpenAI API 調用
  ↓
GPT 響應處理
  ├── 文本格式化
  ├── 段落分段
  └── HTML 渲染
  ↓
結果展示 (ResultView/ZiWeiResult)
```

### 廣告門控流程

```
用戶操作
  ↓
useAdGating.ts
  ├── 檢查是否需要廣告
  ├── 追蹤點擊次數
  └── 控制功能訪問
  ↓
AdBanner 組件
  ├── 顯示廣告
  ├── 追蹤觀看時長
  └── 記錄點擊
  ↓
解鎖功能
```

## 🎨 UI/UX 設計

### 布局設計
- **三欄布局**（桌面版）
  - 左側：固定廣告欄（60px）
  - 中間：主內容區（flex: 1）
  - 底部：固定廣告欄（60px）

- **單欄布局**（移動版）
  - 隱藏左側廣告
  - 全寬主內容
  - 底部固定廣告

### 視覺設計
- **漸層背景**：`linear-gradient(to bottom right, #eef3f9, #e4ebf4)`
- **卡片式設計**：圓角、陰影、內邊距
- **紫色主題**：`#8B5CF6` 作為主色調
- **響應式字體**：根據螢幕大小調整

## 🔐 安全機制

### API 安全
- ✅ API Key 存儲在後端（Vercel 環境變數）
- ✅ 前端不暴露敏感信息
- ✅ CORS 配置
- ✅ 請求頻率限制

### 錯誤處理
- ✅ 統一錯誤處理機制
- ✅ 重試邏輯（最多 3 次）
- ✅ 用戶友好的錯誤提示
- ✅ 配額監控與警告

## 📊 性能優化

### 前端優化
- **Vite 構建**：快速開發和構建
- **代碼分割**：按路由懶加載
- **資源優化**：圖片和字體優化
- **緩存策略**：靜態資源緩存

### 後端優化
- **Serverless 架構**：按需擴展
- **請求節流**：防止 API 濫用
- **錯誤重試**：提高成功率
- **配額監控**：成本控制

## 🚀 部署流程

### Vercel 部署
1. **GitHub 推送** → 自動觸發部署
2. **構建階段**：`npm run build`
3. **輸出目錄**：`dist/`
4. **Serverless Functions**：`api/` 目錄自動部署
5. **環境變數**：從 Vercel Dashboard 配置

### 構建配置
- **構建命令**：`npm run build`
- **輸出目錄**：`dist`
- **Node 版本**：自動檢測
- **函數超時**：30 秒

## 📈 監控與分析

### 功能監控
- **API 健康檢查**：`/api/health`
- **配額監控**：`quotaMonitor.ts`
- **錯誤日誌**：Console 和 Vercel Logs

### SEO 優化
- **Sitemap.xml**：8 個主要頁面
- **Robots.txt**：爬蟲控制
- **Meta 標籤**：SEO 優化
- **Google Search Console**：索引監控

### 廣告整合
- **Google AdSense**：多位置廣告
- **廣告追蹤**：展示和點擊統計
- **門控機制**：功能訪問控制

## 🔧 開發工具

### 開發環境
- **本地開發**：`npm run dev`
- **API 代理**：Vite proxy 配置
- **熱重載**：Vite HMR
- **TypeScript**：類型檢查

### 測試工具
- **API 測試**：`test-api.js`
- **診斷工具**：`diagnose-vercel.js`
- **健康檢查**：`/api/health`

## 📝 關鍵特性

### 1. 統一的 GPT 服務層
- **單一入口**：`gptService.ts` (1477 行)
- **統一格式**：所有命理服務使用相同接口
- **智能重試**：自動錯誤恢復
- **配額管理**：API 使用監控

### 2. 廣告門控系統
- **智能控制**：根據使用次數控制訪問
- **多種廣告位**：入口、瀏覽、功能前、結果頁、持續
- **收益追蹤**：完整的統計系統

### 3. 響應式設計
- **移動優先**：適配各種設備
- **彈性布局**：Flexbox 和 Grid
- **媒體查詢**：斷點優化

### 4. SEO 優化
- **Sitemap**：完整的頁面索引
- **Meta 標籤**：搜索引擎優化
- **結構化數據**：準備擴展

## 🎯 技術亮點

1. **現代化技術棧**：Vue 3 + TypeScript + Vite
2. **Serverless 架構**：無伺服器，自動擴展
3. **統一服務層**：集中管理 API 調用
4. **類型安全**：TypeScript 全面覆蓋
5. **響應式設計**：完美適配各種設備
6. **SEO 友好**：完整的搜索引擎優化
7. **廣告整合**：智能的收益系統
8. **錯誤處理**：完善的錯誤恢復機制

## 📦 依賴管理

### 生產依賴
- Vue 3 生態系統
- 路由和狀態管理
- 農曆轉換工具
- HTTP 請求庫

### 開發依賴
- TypeScript 編譯器
- Vite 構建工具
- Vue 類型定義
- 並發執行工具

## 🔄 版本控制

- **Git**：版本控制
- **GitHub**：遠程倉庫
- **分支策略**：main 分支
- **CI/CD**：Vercel 自動部署

---

**項目名稱**：生命教練網 (life-coach-web)  
**技術棧**：Vue 3 + TypeScript + Vite + Vercel Serverless  
**部署平台**：Vercel  
**最後更新**：2024-11-15


