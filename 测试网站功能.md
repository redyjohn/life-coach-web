# 🧪 测试网站功能指南

## 快速测试方法

### 方法 1: 使用测试脚本（推荐）

#### Node.js 测试脚本

```bash
# 测试生产环境
npm run test:api

# 或手动指定 URL
node test-api.js https://life-coach-web.vercel.app
```

#### Windows 批处理脚本

```bash
# 测试生产环境
test-api.bat

# 或指定 URL
test-api.bat https://life-coach-web.vercel.app
```

### 方法 2: 手动测试

#### 1. 健康检查

```bash
curl https://life-coach-web.vercel.app/api/health
```

**预期响应：**
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "hasOpenAIKey": true,
  "deployment": "vercel"
}
```

✅ **如果 `hasOpenAIKey: true`** - API Key 已配置
❌ **如果 `hasOpenAIKey: false`** - 需要配置环境变量

#### 2. GPT API (GET)

```bash
curl https://life-coach-web.vercel.app/api/gpt
```

**预期响应：**
```json
{
  "message": "GPT API is working!",
  "method": "GET",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "hasOpenAIKey": true,
  "usage": "Send POST request with { \"prompt\": \"your question\" }"
}
```

#### 3. GPT API (POST) - 简单测试

```bash
curl -X POST https://life-coach-web.vercel.app/api/gpt \
  -H "Content-Type: application/json" \
  -d '{"prompt": "测试", "model": "gpt-3.5-turbo"}'
```

**预期响应：**
```json
{
  "content": "（AI 的回复内容）"
}
```

#### 4. GPT API (POST) - 完整测试

```bash
curl -X POST https://life-coach-web.vercel.app/api/gpt \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "分析这个八字：甲子年、乙丑月、丙寅日、丁卯时",
    "systemPrompt": "你是一位专业的命理老师，擅长八字分析。",
    "model": "gpt-3.5-turbo"
  }'
```

### 方法 3: 在浏览器中测试

1. **访问网站**
   - 打开：https://life-coach-web.vercel.app

2. **打开开发者工具**
   - 按 `F12` 或右键 → "检查"
   - 切换到 "Network"（网络）标签

3. **测试功能**
   - 使用任何 AI 功能（八字、紫微、占卜等）
   - 查看 Network 标签中的 API 请求

4. **检查结果**
   - ✅ 状态码 200 - 成功
   - ❌ 状态码 500 - 服务器错误（通常是 API Key 未配置）
   - ❌ 状态码 429 - 请求过于频繁

## 测试检查清单

### ✅ 基础功能测试

- [ ] 健康检查 API 返回 `hasOpenAIKey: true`
- [ ] GPT API (GET) 正常工作
- [ ] GPT API (POST) 能够返回 AI 回复
- [ ] 网站页面正常加载
- [ ] 浏览器控制台无错误

### ✅ 功能测试

- [ ] 八字命理功能正常
- [ ] 紫微斗数功能正常
- [ ] 塔罗牌占卜功能正常
- [ ] 姓名分析功能正常
- [ ] 易经占卜功能正常

### ✅ 错误处理测试

- [ ] API Key 未配置时显示友好错误信息
- [ ] 网络错误时有重试机制
- [ ] 请求频率控制正常工作

## 常见问题排查

### 问题 1: API 返回 500 错误

**可能原因：**
- OpenAI API Key 未配置
- API Key 无效或过期
- 账户额度不足

**解决方法：**
1. 检查 Vercel 环境变量：https://vercel.com/redyjohns-projects/life-coach-web/settings/environment-variables
2. 确认 `OPENAI_API_KEY` 已配置
3. 重新部署项目

### 问题 2: `hasOpenAIKey: false`

**解决方法：**
1. 在 Vercel Dashboard 添加 `OPENAI_API_KEY` 环境变量
2. 选择所有环境（Production, Preview, Development）
3. 重新部署

### 问题 3: 请求超时

**可能原因：**
- Prompt 太长
- 网络问题
- OpenAI API 响应慢

**解决方法：**
1. 缩短 prompt 长度
2. 检查网络连接
3. 查看 Vercel 函数日志

### 问题 4: 返回空内容

**可能原因：**
- OpenAI API 返回格式错误
- 响应解析失败

**解决方法：**
1. 查看 Vercel 函数日志
2. 检查 API 响应格式

## 查看详细日志

### Vercel 函数日志

1. 访问：https://vercel.com/redyjohns-projects/life-coach-web
2. 点击 "Functions" → `api/gpt` → "Logs"
3. 查看最近的请求日志

**正常日志示例：**
```
📤 Sending request to OpenAI: { model: 'gpt-3.5-turbo', ... }
✅ Successfully received response from OpenAI (XXX characters)
```

**错误日志示例：**
```
❌ OpenAI API key not configured
❌ OpenAI API error: { ... }
```

### 浏览器控制台日志

1. 打开开发者工具（F12）
2. 切换到 "Console" 标签
3. 查看错误信息

**正常日志：**
```
💳 使用付費 OpenAI API
✅ ResultView mounted
```

**错误日志：**
```
GPT API error: { error: 'OpenAI API key not configured', ... }
⚠️ OpenAI API 金鑰未配置。請在 Vercel 環境變數中設置 OPENAI_API_KEY。
```

## 性能测试

### 响应时间

正常响应时间应该在：
- 健康检查：< 500ms
- GPT API：2-10 秒（取决于 prompt 长度）

### 并发测试

测试多个同时请求：
```bash
# 使用 Apache Bench 或类似工具
ab -n 10 -c 2 https://life-coach-web.vercel.app/api/health
```

## 自动化测试

### 使用测试脚本

```bash
# 安装依赖（如果需要）
npm install

# 运行测试
npm run test:api
```

### 集成到 CI/CD

可以将测试脚本集成到 GitHub Actions 或其他 CI/CD 流程中。

---

**提示**：如果所有测试都通过，说明网站运行正常！如果遇到问题，请查看相应的错误日志并参考故障排查指南。

