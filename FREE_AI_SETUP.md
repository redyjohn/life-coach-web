# 🆓 免費 AI 服務配置指南

## 概述

為了避免過度使用 OpenAI API 流量，我們實現了智能的 AI 服務切換機制，優先使用免費的 AI 服務進行測試和開發。

## 🎯 功能特點

### 1. 智能服務切換
- **自動檢測**：系統會自動檢測可用的 AI 服務
- **優先級排序**：免費服務優先，OpenAI 作為備用
- **無縫切換**：當免費服務不可用時自動降級到 OpenAI

### 2. 配額監控
- **實時監控**：監控 OpenAI API 配額狀態
- **自動降級**：配額不足時自動切換到免費服務
- **使用統計**：記錄各服務的使用情況

### 3. 測試模式
- **開發環境**：在 localhost 環境下優先使用免費服務
- **Mock 服務**：提供測試用的模擬 AI 回應
- **完整測試**：支持所有功能的完整測試

## 🛠️ 配置說明

### 1. 免費 AI 服務列表

#### Mock AI (測試用) - 優先級 1
- **用途**：開發和測試
- **特點**：無需 API Key，提供模擬回應
- **狀態**：始終可用

#### Hugging Face - 優先級 2
- **用途**：生產環境免費服務
- **特點**：需要 API Key，提供真實 AI 回應
- **配置**：需要申請 Hugging Face API Key

#### Ollama 本地 - 優先級 3
- **用途**：本地部署
- **特點**：完全免費，需要本地安裝
- **配置**：需要安裝 Ollama 並下載模型

### 2. 環境變量配置

```bash
# 開發模式（優先使用免費服務）
NODE_ENV=development

# OpenAI API Key（備用服務）
OPENAI_API_KEY=your_openai_api_key

# Hugging Face API Key（可選）
HUGGINGFACE_API_KEY=your_huggingface_api_key
```

## 🚀 使用方法

### 1. 自動模式（推薦）
系統會自動選擇最佳可用的 AI 服務：

```typescript
// 在 gptService.ts 中自動處理
const result = await callGPT({
  prompt: '您的問題',
  systemPrompt: '系統提示'
})
```

### 2. 手動測試
訪問測試頁面：`http://localhost:5173/test/free-ai`

- **配額狀態**：查看當前 AI 服務狀態
- **服務測試**：測試各個 AI 服務
- **使用統計**：查看使用情況統計

### 3. 強制使用免費服務
在開發環境下，系統會自動優先使用免費服務。

## 📊 監控和統計

### 1. 配額狀態監控
- 實時監控 OpenAI API 配額
- 自動檢測服務可用性
- 智能切換服務

### 2. 使用統計
- OpenAI 調用次數
- 免費服務調用次數
- 總調用次數
- 成功率統計

### 3. 錯誤處理
- 自動重試機制
- 服務降級處理
- 友好錯誤提示

## 🔧 開發指南

### 1. 添加新的免費服務

```typescript
// 在 freeAIServices 中添加新服務
{
  name: '新服務名稱',
  endpoint: 'https://api.example.com',
  model: 'model-name',
  maxTokens: 1000,
  isAvailable: true,
  priority: 4
}
```

### 2. 實現服務調用邏輯

```typescript
// 在 callService 方法中添加新服務
case '新服務名稱':
  return await this.callNewService(service, prompt, systemPrompt)
```

### 3. 測試新服務

```typescript
// 使用測試頁面驗證新服務
await testNewService()
```

## 🎯 最佳實踐

### 1. 開發階段
- 使用 Mock AI 進行功能測試
- 避免頻繁調用 OpenAI API
- 利用測試頁面驗證功能

### 2. 測試階段
- 使用免費服務進行集成測試
- 監控 API 使用情況
- 驗證服務切換邏輯

### 3. 生產階段
- 配置真實的免費服務 API Key
- 設置合理的配額限制
- 監控服務可用性

## 🚨 注意事項

### 1. API 限制
- 免費服務通常有調用限制
- 注意請求頻率和配額
- 實現適當的重試機制

### 2. 服務可用性
- 免費服務可能不穩定
- 實現降級處理機制
- 提供友好的錯誤提示

### 3. 數據隱私
- 注意敏感數據的處理
- 選擇可信的服務提供商
- 實現適當的數據保護

## 📈 性能優化

### 1. 請求頻率控制
- 實現請求隊列
- 控制並發請求數量
- 避免過度調用

### 2. 緩存機制
- 緩存常見問題的回應
- 減少重複請求
- 提高響應速度

### 3. 錯誤處理
- 實現指數退避重試
- 提供降級服務
- 記錄錯誤日誌

## 🔍 故障排除

### 1. 免費服務不可用
- 檢查網絡連接
- 驗證 API Key 配置
- 查看服務狀態

### 2. OpenAI 配額不足
- 檢查 API Key 有效性
- 查看配額使用情況
- 考慮升級計劃

### 3. 服務切換失敗
- 檢查服務配置
- 查看錯誤日誌
- 驗證降級邏輯

## 📞 支持

如果您在使用過程中遇到問題，請：

1. 查看控制台錯誤日誌
2. 檢查服務配置
3. 使用測試頁面驗證功能
4. 參考本文檔的故障排除部分

---

**🎉 現在您可以安心地進行測試和開發，不用擔心 OpenAI API 配額問題！**

